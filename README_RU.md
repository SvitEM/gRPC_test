# gRPC –¢–µ—Å—Ç—ã –ó–∞–¥–µ—Ä–∂–∫–∏ (TLS 1.3 + mTLS)

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É **DF** (—Å–µ—Ä–≤–µ—Ä/—Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º) –∏ **SMFT** (–∫–ª–∏–µ–Ω—Ç/–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–≥—Ä—É–∑–∫–∏) –Ω–∞ Python 3.11 —Å `grpc.aio` –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

## –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–≤–∞ —Ç–µ—Å—Ç–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ `CLAUDE.md`:

1. **01_steady** ‚Äî –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π RPS (500/1000/1200/2000) —á–µ—Ä–µ–∑ **–æ–¥–∏–Ω –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–∞–Ω–∞–ª** (HTTP/2 –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ)
2. **02_coldconn** ‚Äî **–ù–æ–≤—ã–π –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞** —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é 1 RPS –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.11+
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- OpenSSL (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤)

### üöÄ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Protobuf 6.x (–í—ã—Å–æ–∫–∞—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)**

–î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å protobuf 6.x:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å protobuf 6.x (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
./quick_protobuf6_test.sh

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
source venv_test/bin/activate

# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (–±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è)
python test_server_simple.py &
N_RPS=100 T_DURATION_SEC=10 python test_insecure_steady.py
```

**–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: ~15% –±—ã—Å—Ç—Ä–µ–µ —á–µ–º protobuf 4.x!

### üì¶ **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**

1. **–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é Protobuf**
   
   **–í–∞—Ä–∏–∞–Ω—Ç A: Protobuf 6.x (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)**
   ```bash
   python3.11 -m venv venv_protobuf6
   source venv_protobuf6/bin/activate
   pip install protobuf>=6.32.0 grpcio>=1.74.0 grpcio-tools>=1.74.0 python-dotenv
   ```
   
   **–í–∞—Ä–∏–∞–Ω—Ç B: Protobuf 4.x (—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ Google Cloud)**
   ```bash
   pip install "protobuf>=4.21.0,<5.0.0" "grpcio>=1.60.0" "grpcio-tools>=1.60.0" python-dotenv
   ```

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã—Ö –∑–∞–≥–ª—É—à–µ–∫**
   ```bash
   python -m grpc_tools.protoc --proto_path=proto --python_out=df --grpc_python_out=df proto/score.proto
   python -m grpc_tools.protoc --proto_path=proto --python_out=smft --grpc_python_out=smft proto/score.proto
   ```

3. **–ó–∞–ø—É—Å–∫ DF —Å–µ—Ä–≤–µ—Ä–∞**
   ```bash
   cd df
   python 01_steady_server.py
   # –ò–õ–ò
   python 02_coldconn_server.py
   ```

4. **–ó–∞–ø—É—Å–∫ SMFT –∫–ª–∏–µ–Ω—Ç–æ–≤**
   ```bash
   cd smft
   
   # –¢–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (10 RPS, 30—Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, 5—Å —Ä–∞–∑–æ–≥—Ä–µ–≤)
   N_RPS=10 T_DURATION_SEC=30 T_WARMUP_SEC=5 python 01_steady_client.py
   
   # –¢–µ—Å—Ç —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (1 RPS, 60—Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)  
   T_DURATION_SEC=60 python 02_coldconn_client.py
   ```

5. **–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   ```bash
   python tools/summarize.py smft/01_steady_results.txt
   python tools/summarize.py smft/02_coldconn_results.txt
   ```

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Docker

1. **–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤**
   ```bash
   # DF –°–µ—Ä–≤–µ—Ä
   docker build -t df-server -f df/Dockerfile .
   
   # SMFT –ö–ª–∏–µ–Ω—Ç  
   docker build -t smft-client -f smft/Dockerfile .
   ```

2. **–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker**
   ```bash
   # –ó–∞–ø—É—Å–∫ DF —Å–µ—Ä–≤–µ—Ä–∞
   docker run -d --name df-server \
     -p 50051:50051 \
     -v $(pwd)/df/certs:/app/certs:ro \
     -e DF_HOST=0.0.0.0 \
     -e DF_PORT=50051 \
     -e DELAY_MS=5 \
     df-server
   
   # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   docker run --rm \
     -v $(pwd)/smft/certs:/app/certs:ro \
     -v $(pwd)/results:/app/results \
     -e DF_HOST=df-server \
     -e N_RPS=1000 \
     -e T_DURATION_SEC=300 \
     -e T_WARMUP_SEC=30 \
     --link df-server \
     smft-client python 01_steady_client.py
   
   # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   docker run --rm \
     -v $(pwd)/smft/certs:/app/certs:ro \
     -v $(pwd)/results:/app/results \
     -e DF_HOST=df-server \
     -e T_DURATION_SEC=300 \
     --link df-server \
     smft-client python 02_coldconn_client.py
   ```

## –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ TLS)

–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:

1. **–ó–∞–ø—É—Å–∫ —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞**
   ```bash
   python test_server_simple.py &
   ```

2. **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   ```bash
   N_RPS=10 T_DURATION_SEC=5 T_WARMUP_SEC=1 python test_insecure_steady.py
   ```

3. **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**
   ```bash
   T_DURATION_SEC=5 python test_insecure_coldconn.py
   ```

4. **–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   ```bash
   python tools/summarize.py 01_steady_results.txt
   python tools/summarize.py 02_coldconn_results.txt
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å TLS

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–æ–∑–¥–∞–Ω—ã**
   ```bash
   ls df/certs/  # –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å: ca.crt, server.crt, server.key
   ls smft/certs/  # –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å: ca.crt, client.crt, client.key
   ```

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è protobuf –∑–∞–≥–ª—É—à–µ–∫** (–µ—Å–ª–∏ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
   ```bash
   python -m grpc_tools.protoc --proto_path=proto --python_out=df --grpc_python_out=df proto/score.proto
   python -m grpc_tools.protoc --proto_path=proto --python_out=smft --grpc_python_out=smft proto/score.proto
   ```

3. **–ó–∞–ø—É—Å–∫ DF —Å–µ—Ä–≤–µ—Ä–∞ —Å TLS**
   ```bash
   cd df
   python 01_steady_server.py
   ```
   –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

4. **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   ```bash
   cd smft
   N_RPS=100 T_DURATION_SEC=60 T_WARMUP_SEC=10 python 01_steady_client.py
   ```

5. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Ç–æ—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞**
   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
   cd df
   python 02_coldconn_server.py
   ```
   
   –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
   ```bash
   cd smft
   T_DURATION_SEC=30 python 02_coldconn_client.py
   ```

6. **–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   ```bash
   python tools/summarize.py smft/01_steady_results.txt
   python tools/summarize.py smft/02_coldconn_results.txt
   ```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**DF –°–µ—Ä–≤–µ—Ä (.env)**
```bash
DF_HOST=0.0.0.0          # –ê–¥—Ä–µ—Å –ø—Ä–∏–≤—è–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
DF_PORT=50051            # –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞  
DELAY_MS=5               # –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
TLS_CA=certs/ca.crt      # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç CA
TLS_CERT=certs/server.crt # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞
TLS_KEY=certs/server.key  # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞
```

**SMFT –ö–ª–∏–µ–Ω—Ç (.env)**  
```bash
DF_HOST=localhost        # –ò–º—è —Ö–æ—Å—Ç–∞ —Ü–µ–ª–µ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
DF_PORT=50051           # –ü–æ—Ä—Ç —Ü–µ–ª–µ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
N_RPS=500               # –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É (—Ç–æ–ª—å–∫–æ –¥–ª—è 01_steady)
T_DURATION_SEC=300      # –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
T_WARMUP_SEC=30         # –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–∑–æ–≥—Ä–µ–≤–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è 01_steady)
TLS_CA=certs/ca.crt     # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç CA
TLS_CERT=certs/client.crt # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞  
TLS_KEY=certs/client.key  # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞
```

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

### –õ—ë–≥–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
```bash
# 10 RPS –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
N_RPS=10 T_DURATION_SEC=10 T_WARMUP_SEC=2 python 01_steady_client.py
```

### –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞
```bash
# 500 RPS –Ω–∞ 5 –º–∏–Ω—É—Ç
N_RPS=500 T_DURATION_SEC=300 T_WARMUP_SEC=30 python 01_steady_client.py
```

### –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
```bash
# 2000 RPS –Ω–∞ 10 –º–∏–Ω—É—Ç  
N_RPS=2000 T_DURATION_SEC=600 T_WARMUP_SEC=60 python 01_steady_client.py
```

### –î–ª–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Ö–æ–ª–æ–¥–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```bash
# 300 —Ö–æ–ª–æ–¥–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (5 –º–∏–Ω—É—Ç –ø–æ 1 RPS)
T_DURATION_SEC=300 python 02_coldconn_client.py
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
repo-root/
  proto/score.proto              # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
  df/                           # –°–µ—Ä–≤–µ—Ä DataFactory (SUT)
    Dockerfile
    .env
    01_steady_server.py          # –°–µ—Ä–≤–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    02_coldconn_server.py        # –°–µ—Ä–≤–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∞ —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    certs/ (ca.crt, server.crt, server.key)
  smft/                         # SMFT –∫–ª–∏–µ–Ω—Ç / –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–≥—Ä—É–∑–∫–∏
    Dockerfile  
    .env
    01_steady_client.py          # –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    02_coldconn_client.py        # –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∞ —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    certs/ (ca.crt, client.crt, client.key)
  tools/
    summarize.py                # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏
  README.md                     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
  README_RU.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º
  CLAUDE.md                     # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
```

## –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

**01_steady_results.txt**
```
#TEST=01_steady
{"ok":true,"latency_ms":5.83}
{"ok":true,"latency_ms":6.12}
{"ok":false,"code":"DEADLINE_EXCEEDED"}
```

**02_coldconn_results.txt**
```
#TEST=02_coldconn  
{"ok":true,"t_connect_ms":19.4,"t_first_rpc_ms":6.1,"t_total_ms":25.5}
{"ok":true,"t_connect_ms":18.2,"t_first_rpc_ms":5.8,"t_total_ms":24.1}
```

## –ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –¢–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (10 RPS, 5—Å)
```
–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: 51
–£—Å–ø–µ—à–Ω—ã—Ö: 51 (100.0%)  
–°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞: 8.37–º—Å
P50: 7.34–º—Å | P90: 7.74–º—Å | P95: 8.02–º—Å | P99: 48.16–º—Å
```

### –¢–µ—Å—Ç —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (5 –ø–æ–ø—ã—Ç–æ–∫)
```
–í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫: 5
–£—Å–ø–µ—à–Ω—ã—Ö: 5 (100.0%)
–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: 2.40–º—Å
–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ RPC: 12.12–º—Å  
–°—Ä–µ–¥–Ω–µ–µ –æ–±—â–µ–µ –≤—Ä–µ–º—è: 14.70–º—Å
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TLS

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ **–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π TLS**, —Ç–∞–∫ –∏ **–ø–æ–ª–Ω—ã–π mTLS**:

- **–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π TLS**: –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞
- **mTLS**: –í–∑–∞–∏–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤  

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ OpenSSL:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è CA
openssl genrsa -out ca.key 4096
openssl req -new -x509 -key ca.key -sha256 -subj "/C=RU/ST=Moscow/O=TestLab/CN=TestCA" -days 365 -out ca.crt

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞  
openssl genrsa -out server.key 4096
openssl req -new -key server.key -subj "/C=RU/ST=Moscow/O=TestLab/CN=localhost" -out server.csr
openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 365 -sha256

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞
openssl genrsa -out client.key 4096
openssl req -new -key client.key -subj "/C=RU/ST=Moscow/O=TestLab/CN=smft-client" -out client.csr  
openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt -days 365 -sha256
```

## –û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### **–° Protobuf 6.x (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
- **–°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞**: ~7.1–º—Å (5–º—Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ + 2.1–º—Å –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã)
- **P99 –∑–∞–¥–µ—Ä–∂–∫–∞**: ~8.2–º—Å (–æ—á–µ–Ω—å —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: –î–æ 2000+ RPS —É—Å—Ç–æ–π—á–∏–≤–æ
- **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**: ~0.05–º—Å (–Ω–∞ 15% –±—ã—Å—Ç—Ä–µ–µ protobuf 4.x)

### **–° Protobuf 4.x (–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)**
- **–°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞**: ~8.4–º—Å (5–º—Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ + 3.4–º—Å –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã)  
- **P99 –∑–∞–¥–µ—Ä–∂–∫–∞**: ~48–º—Å (–±–æ–ª—å—à–∏–µ –∫–æ–ª–µ–±–∞–Ω–∏—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π)
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: –î–æ 1500+ RPS —É—Å—Ç–æ–π—á–∏–≤–æ
- **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**: ~0.06–º—Å

### **–û–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**
- **–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: ~5–º—Å –Ω–∞ –∑–∞–ø—Ä–æ—Å (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `DELAY_MS`)
- **–°–µ—Ç–µ–≤—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã**: ~1-3–º—Å –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**: ~15-25–º—Å –¥–ª—è TLS handshake (—Ö–æ–ª–æ–¥–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
- **HTTP/2 –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–∞–Ω–∞–ª–∞—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ protobuf 6.x –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫, —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —à—É–º –∏–∑–º–µ—Ä–µ–Ω–∏–π.

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π Protobuf**
   ```
   ImportError: cannot import name 'runtime_version' from 'google.protobuf'
   ```
   **–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∑–∞–≥–ª—É—à–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π protobuf:
   ```bash
   rm df/score_pb2*.py smft/score_pb2*.py
   python -m grpc_tools.protoc --proto_path=proto --python_out=df --grpc_python_out=df proto/score.proto
   python -m grpc_tools.protoc --proto_path=proto --python_out=smft --grpc_python_out=smft proto/score.proto
   ```

2. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
   ```
   googleapis-common-protos —Ç—Ä–µ–±—É–µ—Ç protobuf<5.0.0, –Ω–æ —É –≤–∞—Å protobuf 6.32.0
   ```
   **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è protobuf 6.x:
   ```bash
   ./quick_protobuf6_test.sh  # –°–æ–∑–¥–∞–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
   ```

3. **–û—à–∏–±–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ CN —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º —Ö–æ—Å—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `localhost` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)  
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ü–µ–ø–æ—á–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤: `openssl verify -CAfile ca.crt server.crt`

4. **–¢–∞–π–º–∞—É—Ç—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**  
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç: `netstat -an | grep 50051`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞ –¥–ª—è –ø–æ—Ä—Ç–∞ 50051

5. **–û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞**
   - –ü–µ—Ä–µ—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ protobuf –∑–∞–≥–ª—É—à–∫–∏: `python -m grpc_tools.protoc ...`
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã `grpcio` –∏ `python-dotenv`

### –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è gRPC:
```bash
export GRPC_VERBOSITY=DEBUG
export GRPC_TRACE=all
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç
netstat -an | grep 50051

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
openssl x509 -in df/certs/server.crt -text -noout | head -20

# –¢–µ—Å—Ç SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
openssl s_client -connect localhost:50051 -CAfile df/certs/ca.crt
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ—Å—Ç–æ–≤
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f smft/01_steady_results.txt
tail -f smft/02_coldconn_results.txt

# –ü–æ–¥—Å—á—ë—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
grep '"ok":true' smft/01_steady_results.txt | wc -l
```

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (30 —Å–µ–∫—É–Ω–¥)
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –°–µ—Ä–≤–µ—Ä
cd df && python 01_steady_server.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ö–ª–∏–µ–Ω—Ç  
cd smft && N_RPS=50 T_DURATION_SEC=30 T_WARMUP_SEC=5 python 01_steady_client.py
```

### –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (10 –º–∏–Ω—É—Ç)
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –°–µ—Ä–≤–µ—Ä
cd df && python 01_steady_server.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ö–ª–∏–µ–Ω—Ç
cd smft && N_RPS=1000 T_DURATION_SEC=600 T_WARMUP_SEC=60 python 01_steady_client.py
```

### –ê–Ω–∞–ª–∏–∑ —Ö–æ–ª–æ–¥–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –°–µ—Ä–≤–µ—Ä
cd df && python 02_coldconn_server.py  

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ö–ª–∏–µ–Ω—Ç (100 —Ö–æ–ª–æ–¥–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
cd smft && T_DURATION_SEC=100 python 02_coldconn_client.py
```

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ú–µ—Ç—Ä–∏–∫–∏ —Ç–µ—Å—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **latency_ms**: –í—Ä–µ–º—è –æ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
- **–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**: 5-10–º—Å (5–º—Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ + –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã)
- **P99 > 50–º—Å**: –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å garbage collection –∏–ª–∏ —Å–µ—Ç—å—é

### –ú–µ—Ç—Ä–∏–∫–∏ —Ç–µ—Å—Ç–∞ —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è  
- **t_connect_ms**: –í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ TLS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **t_first_rpc_ms**: –í—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ RPC –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **t_total_ms**: –û–±—â–µ–µ –≤—Ä–µ–º—è (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ + RPC)
- **–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**: 15-30–º—Å –æ–±—â–µ–µ –≤—Ä–µ–º—è –¥–ª—è localhost

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `time.perf_counter_ns()` –¥–ª—è –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω—ã—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π
- **–ö–æ–Ω—Ç—Ä–æ–ª—å RPS**: –ß–∏—Å—Ç–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ asyncio tick –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫  
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è gRPC –∏ —Ç–∞–π–º–∞—É—Ç—ã
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –í runtime —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–ª—å–∫–æ `grpcio` + `python-dotenv`
- **–°–±–æ—Ä–∫–∞**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—É—é —Å–±–æ—Ä–∫—É Docker –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö runtime –æ–±—Ä–∞–∑–æ–≤

## –õ–∏—Ü–µ–Ω–∑–∏—è

–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –Ω–µ –¥–ª—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.